@using iCollections.Data;
@using Microsoft.AspNetCore.Identity;
@inject ICollectionsDbContext AppContext
@model UserProfile

@{
    ViewData["Title"] = "Index";
}

<div class="row">
    <!--Column 1 - About, content, etc-->
    <div class="col col">
        <!--About-->
        <div class="row">

            <div class="col user-profile-obj" id="follow-button">
                @if (Model.ProfileOwner.ProfilePicId.HasValue)
                {
                    <img class="user-profile-img" src="data:image;base64,@System.Convert.ToBase64String(@Model.ProfileOwner.Photos.FirstOrDefault(p => p.Id == Model.ProfileOwner.ProfilePicId.Value).Data)" />
                }
                else
                {
                    <img class="user-profile-img">
                }
                <h2>@Model.ProfileOwner.UserName</h2>
                <h3>@Model.ProfileOwner.FirstName @Model.ProfileOwner.LastName</h3>

                <div class="about-me">
                    <p>Date Joined: @DateTime.Now</p>
                    <p>About me: @Model.ProfileOwner.AboutMe</p>
                    <p>Followers: @Model.ProfileOwner.FollowFollowedNavigations.ToList().Count</p>
                    <p>Following: @Model.ProfileOwner.FollowFollowerNavigations.ToList().Count</p>
                </div>
                <br />
                @if (SignInManager.IsSignedIn(User) && UserManager.GetUserId(User) != Model.ProfileOwner.AspnetIdentityId)
                {
                    string id = UserManager.GetUserId(User);
                    IcollectionUser appUser = AppContext.IcollectionUsers.FirstOrDefault(u => u.AspnetIdentityId == id);
                    @* if (appUser.FollowFollowerNavigations.Count > 0) *@
                    //appUser.FollowFollowerNavigations.Any(x => x.Followed == Model.ProfileOwner.Id);
                    if (Model.ProfileOwner.FollowFollowedNavigations.Any(x => x.Follower == appUser.Id))
                    {
                        <span>
                            <a class="btn btn-primary following-button text-light" value-user="@appUser.Id" value-target="@Model.ProfileOwner.Id">Following</a>
                        </span>
                    }
                    else
                    {
                        <span>
                            <a class="btn btn-primary follow-button text-light" value-user="@appUser.Id" value-target="@Model.ProfileOwner.Id">Follow</a>
                        </span>
                    }
                }

            </div>
        </div>

        <!--Content-->
        <div class="row">
            <div class="col user-profile-obj">
                <h2>Recent Photos:</h2>
                @foreach (var photo in Model.ProfileOwner.Photos.Take<Photo>(10))
                {
                    <div>
                        <p>Name: @photo.Name</p>
                        <p>Date Uploaded: @photo.DateUploaded</p>
                    </div>
                }
            </div>
        </div>
    </div>

    @*    Column 2 - Navigation
        <div class="col col-2 user-profile-nav">
            <h2>Navigation</h2>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a asp-action=Followers asp-route-name="@Model.ProfileOwner.UserName" class="nav-link text-dark">Followers</a>
                </li>
                <li class="nav-item">
                    <a asp-action="Following" asp-route-name="@Model.ProfileOwner.UserName" class="nav-link text-dark">Following</a>
                </li>
                <li class="nav-item">
                    <a asp-action="Collections" asp-route-name="@Model.ProfileOwner.UserName" class="nav-link text-dark">Collections</a>
                </li>
            </ul>
        </div>
    *@


    <!--Temp Navigation-->
    <div class="col-sm-3">
        <div class="col user-profile-nav">

            <h2>Navigation</h2>
            <table style="border-top-style:dotted; border-top-width:initial;" class="table table-hover flex-column">
                <tr class="nav-item">
                    <td><a class="text-primary" asp-action="Following" asp-route-name="@Model.ProfileOwner.UserName">Following</a></td>
                </tr>
                <tr class="nav-item">
                    <td><a class="text-primary" asp-action="Followers" asp-route-name="@Model.ProfileOwner.UserName">Followers</a></td>
                </tr>
                <tr class="nav-item">
                    <td><a class="text-primary" asp-action="Index" asp-controller="Browse">Browse</a></td>
                </tr>
            </table>
        </div>
    </div>
</div>
